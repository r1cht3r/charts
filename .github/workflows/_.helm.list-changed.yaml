---
name: List changed images (container)
on:  # yamllint disable-line rule:truthy
  workflow_call:
    outputs:
      charts:
        description: List of changed charts
        value: ${{ jobs.list-changed.outputs.charts }}

jobs:
  list-changed:
    name: List modified charts
    outputs:
      charts: ${{ steps.format-output.outputs.json }}
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
        with:
          fetch-depth: 10

      - uses: tj-actions/changed-files@cc733854b1f224978ef800d29e4709d5ee2883e4 # v44.5.5
        id: changed-images
        with:
          dir_names: true
          dir_names_max_depth: 2
          files: |
            charts/*/Chart.lock
            charts/*/Chart.yaml
            charts/*/values.yaml
          json: true
      - id: format-output
        run: echo "json=${{ steps.changed-images.outputs.all_changed_files }}" >> "${GITHUB_OUTPUT}"
